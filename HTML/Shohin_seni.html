<?php
// セッション
session_start();

// データベースマネージャの読込
require_once "../データベース関連/DBManager.php";
$db = new DBManager();
?>
<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>システム開発演習</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
    integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="./style_css_file/style1.css">
  <script src="./script_file/newFunction.js"></script>
  <script src="./script_file/script.js"></script>
  <!-- jQuery CDN -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
</head>


<body>
  <!-- ナブバーの記述始まり -->
  <nav class="navbar navbar-dark bg-dark fixed-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="./index.html">
        <p id="midasi">To TSM.</p>
      </a>
      <div class="btn-toolbar">
        <div class="btn-toolbar">
          <!-- 新規登録ボタン
           <div class="button_solid003">
            <a href="https://zozo.jp/_member/regist/?pattern=">新規登録
            </a>
          </div>-->
          <!--新規登録ボタン-->

          <!--ログインボタン-->
          <div class="button_solid003">
            <?php
            if(isset($_SESSION['login_id'])) {
              echo "<a href='./login-file/user_logout' class='textlenlim'>ログアウト<i class='bi bi-box-arrow-right'></i></a>";
            } else {
              echo "<a href='./login-file/user_login.html'>ログイン<i class='bi bi-box-arrow-in-right'></i></a>";
            }
          ?>
          </div>
          <!-- ログインボタン -->
          <div class="btn-group">
            <!--お気に入り閲覧ボタン始  -->
            <button class="navbar-toggler" onClick="location.href='./favorite.html'" type="button"
              data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false">
              <i class="bi bi-heart-fill fs-2"></i>
            </button>
            <!-- お気に入り閲覧ボタン終 -->
            <!-- 検索のアイコン -->
            <button class="navbar-toggler" type="button" onclick="search_onFunc()">
              <i class="bi bi-search fs-2"></i>
            </button>
            <!-- カゴのアイコン -->
            <button class="navbar-toggler" onClick="location.href='./カート内確認.html'"><i class="bi bi-cart4 fs-2"></i>
            </button>
            <!-- Homeのアイコン -->
              <button class="navbar-toggler"onClick="location.href='./index.html'" type="button">
                  <i class="bi bi-house-door-fill fs-1"></i>
  </nav>
  </div>
  </div>
  <!--ナブバの記述終わり  -->

  <!-- ジャンボトロン -->
  <!-- <div id="photo">
    <img src="./back_photo/images4.jpg" />
  </div> -->
  <!--ジャンボトロン-->
  <!-- サブメニュー表示 -->
  <div class="subu-menu-back" id="subumenu" onmouseover="submenu_overFunc()" onmouseleave="submenu_leaveFunc()">
    <div class="submenu-search">
      <h3>--検索--</h3>
      <ul>
        <li><a href="./category.html" class="search-li-1">カテゴリーで検索</a></li>
        <li><a href="./maker.html" class="search-li-2">メーカーで検索</a></li>
        <li><a href="./color.html" class="search-li-3">カラーで検索</a></li>
      </ul>
    </div>
    <div class="submenu-rireki">
      <h3>--購入履歴--</h3>
      <ul>
        <li><a href="./kounyurireki.html" class="rireki-li-1">購入履歴</a></li>
        <li><a href="https://zozo.jp/" class="rireki-li-2">注文中の商品</a></li>
      </ul>
    </div>
  </div>
  <!--サブメニュー表示  -->
  <br><br><br>
  <div class="senni">
    <div>
      <div class="unkounko">
        <img src="./outer_photo/outer_5.jpg" width="45%" align="text-center" alt="アウター" id="pic">
      </div>

      <details>
        <summary class="oritatami"><u>商品詳細</u></summary>
        <p id="description">
          1889年にアメリカのミシガン州デトロイトで誕生したCarhartt（カーハート）。タフなダック地とデニムで作られたオーバーオールを世に送り出したcarhartt(カーハート)は、その後120年以上に渡り愛され続けるワークウェアブランドとして活躍。<br>
          <br>■大人のストリートシーンを演出する都会的なアイテム!【MONO-MARTセレクション】シンプルながらも程よく洗練されたシルエット。こなれたヴィンテージ感漂う魅力的な１着。<br>
          <br>■ワークウェアと言う垣根を越えた理想の逸品。
          豊富なサイズバリエーションながらも身幅にややゆとりを持たせ、程よく肩をドロップさせたトレンド感のあるUSA規格のオーバーサイズシルエット。ゆったりとした印象を与えながらもまとまりのあるサイズバランスで抜け感のあるシルエットを実現。又、カンガルーポケットに施されたブランドピスネームが主張し過ぎない目を引くアクセントになっているのもポイント。スキニー等と合わせたメリハリのあるコーデやストリート、アメカジライクなスタイリング等、幅広いトレンドを楽しめる注目のスウェットアイテム。<br>
          <br>■タフな仕様で長く付き合える仕上がり。ワーク系ブランドらしい程よい厚みのコットン×ポリエステル混紡素材のスウェット生地を採用。良質の裏起毛生地で肌触りは心地よく抜群の着心地を実現！カラーは定番のブラックやグレーをはじめカラーバリエーション豊富で思わず色違いで揃えたくなるほど！絶妙なルーズ感と上品な落ち感を兼ね備えた是非、手に入れたい今シーズンおすすめのマストバイアイテム。
        </p><br style="clear:both;">
      </details>
      <br>
    </div>

    <!-- 新機能：配色をおすすめする機能 -->
    <h3>合わせやすい色</h3>
    <div class="color-btn-raido">
      <input type="radio" name="btn-radio" id="color1" value="color1"><label id="haishoku-1" for="color1"
        onclick="HaishokuColor(color[0],itemList,allMakersList,itemData.items_genre)">
        <p class="haishoku-1">✓</p>
      </label>
      <input type="radio" name="btn-radio" id="color2" value="color2"><label id="haishoku-2" for="color2"
        onclick="HaishokuColor(color[1],itemList,allMakersList,itemData.items_genre)">
        <p class="haishoku-1">✓</p>
      </label>
      <input type="radio" name="btn-radio" id="color3" value="color3"><label id="haishoku-3" for="color3"
        onclick="HaishokuColor(color[2],itemList,allMakersList,itemData.items_genre)">
        <p class="haishoku-1">✓</p>
      </label>
    </div>
    <!--おすすめの色の商品を表示-->
    <div id="kakusu">
      <h2>選択している色：<span id="select-color">色</span></h2>
      <div class="container">
        <div class="row row-cols-lg-4 row-cols-sm-4 row-cols-2 g-4" id="recommended">

        </div>
      </div>
    </div>
    <!-- おすすめの色の商品を表示-->
    <!-- 新機能：配色のおすすめする機能 -->
    <div class="nedan">
      <h3>￥<span id="price">1919</span></h3>
    </div>
    <!-- いいねボタン始 -->
    <div align="right">
      <div class="example2">
        <input type="checkbox" name="example2" id="<?php echo $_GET['itemId'] ?>" onclick="checkFavSt()"><label
          for="<?php echo $_GET['itemId'] ?>"><i class="bi bi-heart-fill fs-4"></i></label>
      </div>
    </div>
    <!-- いいねボタン終 -->
    <div class="example3">
      <div class="size">
        <input type="radio" name="exmple3" id="size1" value="S"><label for="size1">S</label>
        <input type="radio" name="exmple3" id="size2" value="M" checked><label for="size2">M</label>
        <input type="radio" name="exmple3" id="size3" value="L"><label for="size3">L</label>
        <input type="radio" name="exmple3" id="size4" value="XL"><label for="size4">XL</label>
      </div>
    </div>

    <!-- <div class="suryou">
      <input type="button" value="+"><input type="text" value="1" size="1" class="pa"><input type="button" value="-">
    </div> -->

    <div class="suryou_area">
      <label class="number-spinner-wrap">
        <input type="number" class="cnt_btn" id="cnt_btn1" value="1" min="1" max="5" step="1" pattern="^[0-9]+$">
        <button class="spinner spinner-down">-</button>
        <button class="spinner spinner-up">+</button>
      </label>
    </div>

    <div class="mae">
      <button class="btn-cart" onClick="history.go(-1)">戻る</button>
    </div>

    <div class="reji">
      <form action="./住所登録.html" method="post" class="buynow">
        <!-- <a href="./決済_html/住所登録.html"> -->
        <input type="hidden" name="itemid" value="" id="itemId2">
        <input type="hidden" name="itemsize" value="" id="itemSize2">
        <input type="hidden" name="itemvol" value="1" id="itemVol2">
        <button type="submit" class="btn-kounyu-148" onclick="chksize(1)">今すぐ購入</button>
        <!-- </a> -->
      </form>
      <form action="./kounyuu.html" method="post">
        <!-- <a href="./kounyuu.html"> -->
        <input type="hidden" name="itemid" value="" id="itemId">
        <input type="hidden" name="itemsize" value="" id="itemSize">
        <input type="hidden" name="itemvol" value="10" id="itemVol">
        <button type="submit" class="btn-cart" onclick="chksize(0)">カートに入れる</button>
        <!-- </a> -->
      </form>
    </div>
  </div>

  <br>

  <!-- おすすめ -->
  <h2 class="osusume">こちらの商品もおすすめです</h2>
  <div class="container">
    <div class="row row-cols-lg-4 row-cols-sm-4 row-cols-2 g-4" id="recommend">
      <!-- おすすめ自動生成 -->
    </div>
  </div>



  <!--フッター始まり-->
  <div>
    <footer class="py-3 my-4">
      <ul class="nav justify-content-center border-bottom pb-3 mb-3">
        <li class="nav-item"><a href="index.html" class="nav-link px-2 text-muted">HOME</a></li>
        <li class="nav-item"><a href="./FAQ/FAQ.html" class="nav-link px-2 text-muted">FAQ</a>
        </li>
        <li class="nav-item"><a href="./FAQ/gaiyouno.html"
            class="nav-link px-2 text-muted">概要</a></li>
      </ul>
      <p class="text-center text-muted"><img src="./sweat_photo/beni2.png" style="height: 100px;"></p>
    </footer>
  </div>
  <!-- フッター終わり -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js"
    integrity="sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK"
    crossorigin="anonymous"></script>
  <script>
    const itemData = JSON.parse('<?php echo $db->getItem($_GET["itemId"]) ?>');
    const size = document.getElementsByName('exmple3');
    let selectSize;

    const itemList = JSON.parse('<?php echo $db->getAllItems() ?>');
    const allMakersList = JSON.parse('<?php echo $db->getAllMaker(); ?>');

    // console.log(itemData);
    document.getElementById('itemId').value = itemData.items_id;
    document.getElementById('itemId2').value = itemData.items_id;
    document.getElementById('description').innerHTML = itemData.items_description;
    document.getElementById('price').innerHTML = itemData.items_price;
    document.getElementById('pic').src = './' + itemData.items_genre + '_photo/' + itemData.items_url;

    const color = setColor(itemData.items_color);
    console.log(color);


    if (new Set(getFavorite()).has(itemData.items_id)) {
      document.getElementById(itemData.items_id).checked = true;
    }
    // const genre = 

    function chksize(mode) {
      for (let i = 0; i < size.length; i++) {
        if (size[i].checked) {
          selectSize = size[i].value;
        }
      }

      if (mode == 0) {
        document.getElementById('itemSize').value = selectSize;
        document.getElementById('itemVol').value = document.getElementById('cnt_btn1').value;
        let vol = document.getElementById('itemVol').value;

        addCart(itemData.items_id, selectSize, vol);
      } else if (mode == 1) {
        document.getElementById('itemSize2').value = selectSize;
        document.getElementById('itemVol2').value = document.getElementById('cnt_btn1').value;
        let vol = document.getElementById('itemVol2').value;
      }

    }

    function checkFavSt() {
      const favorite = document.getElementById(itemData.items_id);
      // console.log(favorite.checked);
      if (favorite.checked) {
        addFavorite(itemData.items_id);
      } else {
        delFavorite(itemData.items_id);
      }
    }
  </script>

  <!-- 数量変更処理js -->
  <script>
    const $wrap = document.querySelector('.number-spinner-wrap');
    const $input = $wrap.querySelector('input');
    $wrap.querySelector('.spinner-down').onclick = () => {
      $input.stepDown()
    }
    $wrap.querySelector('.spinner-up').onclick = () => {
      $input.stepUp()
    }
    // let changeIndexList = new Map();

    // function inc(id) {
    //   const $wrap = document.getElementById(id);
    //   const $input = $wrap.querySelector('input');
    //   $wrap.querySelector('.spinner-up').onclick = () => {
    //     $input.stepUp();
    //     // console.log($input.value);
    //     changeIndexList.set(id, $input.value);
    //     document.getElementById('sp' + id).innerHTML = cart[id].price * $input.value;
    //     console.log(changeIndexList);
    //   }
    // }

    // function dec(id) {
    //   const $wrap = document.getElementById(id);
    //   const $input = $wrap.querySelector('input');
    //   $wrap.querySelector('.spinner-down').onclick = () => {
    //     $input.stepDown();
    //     changeIndexList.set(id, $input.value);
    //     document.getElementById('sp' + id).innerHTML = cart[id].price * $input.value;
    //     console.log(changeIndexList);
    //   }

    // }
  </script>
  <script>
    for (let i = 0; i < 4; i++) {
      var r = Math.floor(Math.random() * itemList.length);
      console.log(r);
      createItemCard('recommend', itemList[r].items_id, itemList[r].items_genre, allMakersList[itemList[r].makers_id - 1].makers_name, itemList[r].items_name, itemList[r].items_price, itemList[r].items_url);
    }
  </script>
</body>

</html>